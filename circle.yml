machine:
  java:
    version: oraclejdk8
  environment:
    TERM: dumb
  node:
    version: 6.3.1

dependencies:
  override:
    - ./gradlew --parallel resolveConfigurations
    - cd conjure-typescript-ete-test && ./gradlew --parallel resolveConfigurations && cd ..
  cache_directories:
    - ./conjure-typescript-ete-test/.gradle
    - ./conjure-typescript-ete-test/typescript-ete-test-app/node_modules
test:
  override:
    - ? |
          set -eu
          set -o pipefail

          case $CIRCLE_NODE_INDEX in
          0)
            ./gradlew --parallel build
            ;;
          1)
            cd conjure-typescript-ete-test && bash ./scripts/verify.sh && cd ..
            ;;
          esac
      :
        parallel: true
        timeout: 1200

deployment:
  snapshots:
    branch: develop
    owner: elements
    commands:
      - git clean -xfd
      - ./gradlew -i artifactoryPublish
  releases:
    tag: /[0-9]+(\.[0-9]+)+((-(beta|rc)[0-9]{1,2})(\.[0-9])?)?/
    owner: elements
    commands:
      - git clean -xfd
      - ./gradlew -i artifactoryPublish

