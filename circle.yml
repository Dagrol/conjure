machine:
  post:
    - wget -qO- https://artifactory.palantir.build/artifactory/internal-dist-thirdparty/oracle/jce_policy/8/jce_policy-8.zip
      | bsdtar -xvf- -C /tmp && sudo cp /tmp/UnlimitedJCEPolicyJDK8/* $JAVA_HOME/jre/lib/security/
    - cd /home/ubuntu/.pyenv/plugins/python-build/../.. && git pull && cd - && pyenv install --skip-existing 3.6.0 && pyenv
      global 2.7.10 3.6.0
    - pyenv global 2.7.10 3.6.0
  java:
    version: oraclejdk8
  services:
    - docker
  environment:
    TERM: dumb
  node:
    version: 6.3.1

dependencies:
  cache_directories:
    - "~/.cache/pip"
    - "~/.pyenv"
  override:
    - ./gradlew --parallel resolveConfigurations
    - pip install tox

test:
  override:
    - ./gradlew --parallel --stacktrace build

deployment:
  snapshots:
    commands:
      - git clean -xfd
      - ./gradlew -i --stacktrace --continue publish condaPublish publishConjureIr_snapshot exartisi
    branch: develop
    owner: foundry
  releases:
    tag: /[0-9]+(\.[0-9]+)+((-(beta|rc)[0-9]{1,2})(\.[0-9])?)?/
    owner: foundry
    commands:
      - git clean -xfd
      - ./gradlew -i --stacktrace --continue publish condaPublish publishConjureIr_release exartisi

notify:
  webhooks:
    - url: https://parana.palantir.build/hook
